<!DOCTYPE html>
<html lang="zh-Hant">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ä¼‘ã€é€€å­¸èˆ‡å¾©å­¸æŒ‡å¼•</title>
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Noto+Sans+TC:wght@400;700&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="/SSGS-Web-App/styles.css">
    <style>
        .step-section { display: none; }
        .step-section.active { display: block; }
        .id-display-badge { background: var(--primary-color); color: white; padding: 5px 15px; border-radius: 20px; font-size: 0.9em; margin-bottom: 20px; display: inline-block; }
        .warning-note { background-color: #ffeaea; border-left: 5px solid red; padding: 15px; margin-top: 15px; color: #cc0000; text-align: left; }
        .step-list { text-align: left; list-style: disc; padding-left: 20px; }
        .location-hint { color: #2e7d32; font-weight: bold; }
        .download-link { color: var(--primary-color); font-weight: bold; text-decoration: underline; }
        .error-hint { color: red; font-size: 0.85em; display: none; margin-top: -15px; margin-bottom: 15px; }
        /* æ–°å¢ï¼šéæ—¥é–“éƒ¨æç¤ºæ¨£å¼ */
        .other-unit-box { background-color: #fff9c4; border: 1px solid #fbc02d; padding: 20px; border-radius: 10px; text-align: left; margin: 20px 0; }
    </style>
</head>
<body>
    <div class="container">
        <div id="step-identify" class="step-section active">
            <h1>ğŸ†” èº«ä»½è¾¨è­˜</h1>
            <p>è«‹è¼¸å…¥å­¸è™Ÿä»¥å–å¾—ç²¾æº–çš„ä¼‘/é€€/å¾©å­¸ç”³è«‹æµç¨‹ï¼š</p>
            <input type="text" id="studentIdInput" placeholder="è«‹è¼¸å…¥ 10 ç¢¼å­¸è™Ÿ" maxlength="10" class="calc-input" 
                   style="width: 80%; max-width: 300px; margin-bottom: 20px; padding: 10px; border: 2px solid var(--primary-color); border-radius: 8px;">
            <div id="idError" class="error-hint">âš ï¸ è«‹è¼¸å…¥æ­£ç¢ºçš„ 10 ç¢¼æ•¸å­—å­¸è™Ÿ</div>
            <br>
            <button onclick="startGuide()" class="decision-button">å–å¾—ç²¾æº–æµç¨‹</button>
            <p style="font-size: 0.8em; color: #666; margin-top: 15px;">â€» æœ¬ç³»çµ±åƒ…æ–¼ç€è¦½å™¨è¨˜æ†¶é«”è™•ç†è³‡è¨Šï¼Œé—œé–‰å¾Œå³å¾¹åº•æ¸…é™¤ã€‚</p>
        </div>

        <div id="step-content" class="step-section">
            <div class="id-display-badge">ç•¶å‰å­¸è™Ÿï¼š<span id="currentIdDisplay"></span></div>
            <h1>â³ ä¼‘/é€€å­¸èˆ‡å¾©å­¸æŒ‡å¼•</h1>
            
            <div id="dynamicGuideBody"></div>

            <div style="margin-top: 30px; display: flex; gap: 10px; justify-content: center; flex-wrap: wrap;">
                <button onclick="resetSPA()" class="option-button" style="background-color: #f0f0f0; color: #333; width: auto; padding: 10px 20px;">é‡æ–°æŸ¥è©¢</button>
                <a href="/SSGS-Web-App/service_menu.html" class="option-button" style="width: auto; padding: 10px 20px;">è¿”å›æœå‹™é¸å–®</a>
            </div>
        </div>
    </div>

    <script>
        function startGuide() {
            const idInput = document.getElementById('studentIdInput');
            const errorHint = document.getElementById('idError');
            const id = idInput.value.trim();
            const idRegex = /^[0-9]{10}$/;
            
            // 1. åŸºæœ¬é©—è­‰ï¼šå¿…é ˆ 10 ç¢¼æ•¸å­—
            if (!idRegex.test(id)) {
                errorHint.textContent = "âš ï¸ è«‹è¼¸å…¥æ­£ç¢ºçš„ 10 ç¢¼æ•¸å­—å­¸è™Ÿ";
                errorHint.style.display = 'block';
                idInput.style.borderColor = 'red';
                return;
            }

            const firstDigit = id.charAt(0);
            const secondChar = id.charAt(1);
            const guideBody = document.getElementById('dynamicGuideBody');
            document.getElementById('currentIdDisplay').textContent = id;

            // 2. ç¯©é¸æ—¥é–“éƒ¨å­¸ç”Ÿ (å­¸è™Ÿ 1 é–‹é ­)
            if (firstDigit === '1') {
                errorHint.style.display = 'none';
                idInput.style.borderColor = 'var(--primary-color)';
                
                let studentLevel = "æ—¥é–“éƒ¨å­¸ç”Ÿ";
                let requiresConsent = ['1', '2', '4'].includes(secondChar); // ç¬¬äºŒç¢¼ 1,2,4 éœ€åŒæ„æ›¸

                if (secondChar === '1') studentLevel = "æ—¥é–“éƒ¨äº”å°ˆéƒ¨";
                else if (['2', '4'].includes(secondChar)) studentLevel = "æ—¥é–“éƒ¨å››æŠ€/äºŒæŠ€éƒ¨";
                else studentLevel = "æ—¥é–“éƒ¨ç ”ç©¶æ‰€/å…¶ä»–";

                let contentHtml = `<p>æ‚¨çš„èº«ä»½å·²è¾¨è­˜ç‚ºï¼š<strong style="color: var(--primary-color);">${studentLevel}</strong>ã€‚</p>`;
                contentHtml += '<div class="result-box" style="text-align:left;">';
                contentHtml += '<h3>ç¬¬ä¸€éšæ®µï¼šç”³è«‹æ–‡ä»¶æº–å‚™</h3>';
                contentHtml += `<p>è¾¦ç†åœ°é»ï¼š<span class="location-hint">ä¸‰æ°‘æ ¡å€ï¼ˆä¸­æ­£å¤§æ¨“2æ¨“ï¼‰</span> æˆ– <span class="location-hint">æ°‘ç”Ÿæ ¡å€ï¼ˆèª æ•¬æ¨“2æ¨“ï¼‰</span>ã€‚</p>`;
                
                // æ°‘ç”Ÿæ ¡å€åˆ¤æ–·
                if (id.includes("510") || id.includes("520") || id.includes("530")) {
                    contentHtml += '<p style="color:red; font-weight:bold;">âš ï¸ æé†’ï¼šæ‚¨çš„ç§‘ç³»è«‹è‡³æ°‘ç”Ÿæ ¡å€è¾¦ç†ã€‚</p>';
                }

                contentHtml += '<h4>ä¼‘ã€é€€å­¸å¿…å‚™æ–‡ä»¶æ¸…å–®</h4>';
                contentHtml += '<ul class="step-list">';
                contentHtml += `<li><a href="/SSGS-Web-App/forms/åœ‹ç«‹è‡ºä¸­ç§‘æŠ€å¤§å­¸(ä¼‘ã€é€€ã€å¾©)å­¸ç”³è«‹æ›¸.pdf" download class="download-link">ã€Š(ä¼‘ã€é€€ã€å¾©)å­¸ç”³è«‹æ›¸ã€‹</a> (B4å°ºå¯¸)</li>`;
                
                if (requiresConsent) {
                    contentHtml += `
                        <li class="warning-note">
                            <strong>å¿…å‚™æ–‡ä»¶ï¼š</strong> <a href="/SSGS-Web-App/forms/åœ‹ç«‹è‡ºä¸­ç§‘æŠ€å¤§å­¸(ä¼‘ã€é€€)å­¸å®¶é•·åŒæ„æ›¸.pdf" download style="color:red; font-weight:bold;">ã€Šå®¶é•·åŒæ„æ›¸ã€‹</a><br>
                            (å› æ‚¨çš„å­¸åˆ¶è¾¨è­˜ç‚º ${studentLevel}ï¼Œéœ€æª¢é™„å®¶é•·æˆ–ç›£è­·äººç°½ç« )
                        </li>`;
                } else {
                    contentHtml += '<li><strong style="color: green;">ç„¡éœ€</strong> ç¹³äº¤å®¶é•·åŒæ„æ›¸ã€‚</li>';
                }

                contentHtml += '<li>å­¸ç”Ÿè­‰ (å¦‚éºå¤±é ˆå…ˆç·šä¸Šæ›å¤±ä¸¦æ–¼ç”³è«‹æ›¸è¨»æ˜)</li>';
                contentHtml += '<li>å­¸é›œè²»é€€è²»ï¼šç¬¦åˆé€€è²»æ¨™æº–è€…ï¼Œè«‹é™„ç¹³è²»æ”¶æ“šæ­£æœ¬åŠæœ¬äººå­˜æ‘ºå°é¢å½±æœ¬ã€‚</li>';
                contentHtml += '</ul>';
                contentHtml += '<h4 style="margin-top: 20px;">ç¬¬äºŒéšæ®µï¼šæœƒè¾¦èˆ‡ç‰¹æ®Šè™•ç†</h4>';
                contentHtml += '<ul class="step-list"><li>æµç¨‹é †åºï¼šå°å¸« â†’ ç³»ä¸»ä»» â†’ ç›¸é—œæœƒè¾¦å–®ä½ â†’ è¨»å†Šçµ„ã€‚</li><li>å­¸è²¸èº«ä»½ï¼šéœ€æœƒè¾¦èª²å¤–æ´»å‹•æŒ‡å°çµ„ã€‚</li><li>å…µå½¹æé†’ï¼šç”·ç”Ÿæœªæœå½¹éœ€è‡³è¨»å†Šçµ„å¡«å¯«å…µå½¹åˆ‡çµæ›¸ã€‚</li></ul></div>';

                guideBody.innerHTML = contentHtml;

            } 
            // 3. éæ—¥é–“éƒ¨å­¸ç”Ÿ (å­¸è™Ÿ 2, 3, 4 é–‹é ­)
            else if (['2', '3', '4'].includes(firstDigit)) {
                let contactUnit = "";
                let contactTel = "";
                switch (firstDigit) {
                    case '2': contactUnit = "é€²ä¿®éƒ¨å¤œé–“ç­"; contactTel = "04-22195720"; break;
                    case '3': contactUnit = "é€²ä¿®éƒ¨å¹³å‡æ—¥ç­"; contactTel = "04-22195920"; break;
                    case '4': contactUnit = "ç©ºä¸­å­¸é™¢è¨»å†Šçµ„"; contactTel = "04-22195820"; break;
                }
                
                guideBody.innerHTML = `
                    <div class="other-unit-box">
                        <h3 style="color: #d32f2f; margin-top:0;">âš ï¸ è·¨å–®ä½æé†’</h3>
                        <p>æœ¬ç³»çµ±ç‚º<strong>æ—¥é–“éƒ¨è¨»å†Šçµ„</strong>å°ˆç”¨ï¼ˆå­¸è™Ÿ 1 é–‹é ­ï¼‰ã€‚</p>
                        <p>æ‚¨çš„å­¸è™Ÿé¦–ç¢¼ç‚º <strong>${firstDigit}</strong>ï¼Œéš¸å±¬æ–¼ï¼š<br><strong>${contactUnit}</strong></p>
                        <p>è«‹æ’¥æ‰“è©²å–®ä½å°ˆç·šæ´½è©¢ï¼š<br><a href="tel:${contactTel.replace(/-/g,'')}" style="font-size: 1.2em; font-weight: bold; color: var(--primary-color);">${contactTel}</a></p>
                    </div>`;
            } 
            // 4. å­¸è™Ÿè¼¸å…¥æœ‰èª¤ (é 1, 2, 3, 4 é–‹é ­)
            else {
                guideBody.innerHTML = `
                    <div class="warning-note" style="font-size: 1.1em;">
                        <p>âŒ å­¸è™Ÿè¼¸å…¥æœ‰èª¤</p>
                        <p>è«‹é‡æ–°è¼¸å…¥ï¼Œæˆ–ä¾†é›»ç”±æ—¥é–“éƒ¨å°ˆäººå”åŠ©ï¼š<br><a href="tel:04-22195130" style="font-weight:bold;">04-22195130</a></p>
                    </div>`;
            }

            // åˆ‡æ›å€å¡Š
            document.getElementById('step-identify').classList.remove('active');
            document.getElementById('step-content').classList.add('active');
        }

        function resetSPA() {
            document.getElementById('studentIdInput').value = "";
            document.getElementById('idError').style.display = 'none';
            document.getElementById('studentIdInput').style.borderColor = 'var(--primary-color)';
            document.getElementById('step-content').classList.remove('active');
            document.getElementById('step-identify').classList.add('active');
        }

        if ('serviceWorker' in navigator) {
            window.addEventListener('load', () => {
                navigator.serviceWorker.register('service-worker.js')
                    .then(reg => console.log('SSGS App å•Ÿå‹•æˆåŠŸï¼'))
                    .catch(err => console.log('å•Ÿå‹•å¤±æ•—ï¼š', err));
            });
        }
    </script>
</body>
</html>
